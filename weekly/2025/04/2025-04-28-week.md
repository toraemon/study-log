# 🗓️ 2025年04月28日（月）学習ログ（Selinger論文：セクション2〜セクション3）

## ✅ 学習概要

- Selingerらによる論文「Access Path Selection in a Relational Database Management System」を読んだ。
- 本日はイントロダクション〜セクション3までを精読し、SQL処理の流れとアクセスパス（スキャン方法）について学んだ。
- 内容の定着を確認するため、ゴエモン作成の簡易理解度チェック問題にも取り組んだ。

## 🕰️ 学習時間
90分

---

## 📚 使用教材

- Selinger, P. Griffiths et al., *Access Path Selection in a Relational Database Management System*, 1979（提供PDF）
- ゴエモン作成の理解度チェック問題

---

## 📖 学習範囲・内容

- **SQL処理の4段階プロセス**（Parsing → Optimization → Code Generation → Execution）
- **オプティマイザの役割**
  - 参照テーブル・カラムの存在チェック
  - 統計情報の取得
  - アクセスパス選択（トータルコスト最小化）
- **ストレージアクセスの種類**
  - セグメントスキャン（フルスキャン）
  - インデックススキャン（範囲・部分取得）
- **インデックスの構造**
  - B-treeベースで実装され、クラスタリングされているとアクセス効率が向上
- **SARG（Search Argument）**
  - "カラム = 値"のような単純な比較式をスキャン時に事前適用できることでコスト削減
- **理解度チェック問題での総合確認**
  - 全問正解、重要概念を正しく整理できた

---

## 📊 疑問点と確認結果

| 項目 | 疑問 | メモ・確認ポイント |
| :--- | :--- | :--- |
| SARGとは何か？ | どこに記載がある？ | Section 3中盤に記載あり。スキャン前に適用可能な単純比較条件（col = value など）を指す。 |
| クラスタードインデックスのメリット | なぜアクセスコストが下がる？ | データが物理的にもインデックス順に近く並び、範囲アクセス時にI/O効率が上がるため。 |

---

## 📝 復習問題と回答

### 【問題1】
**System RでSQL文を処理するときの基本的な4つのステップは何か、順番に答えてにゃ。**

**回答:**  
Parsing → Optimization → Code Generation → Execution

---

### 【問題2】
**System Rのオプティマイザの役割を次から選んでにゃ。**

- A. 文法エラーを検出する  
- B. 最小コストのアクセスパスを選択する  
- C. SQL文をマシン語に翻訳する  
- D. 物理ページのI/O制御を行う

**回答:**  
B. 最小コストのアクセスパスを選択する

---

### 【問題3】
**セグメントスキャンとは何をする操作か、次から選んでにゃ。**

- A. インデックスを使って特定のデータだけを取り出す  
- B. テーブルの全データ（全ページ）を順番に読みながら必要な行を取り出す  
- C. データを並び替えてからアクセスする  
- D. 複数テーブルを結合する操作を始める

**回答:**  
B. テーブルの全データを順番に読む

---

### 【問題4】
**インデックススキャンに関して、正しい説明を次から選んでにゃ。**

- A. 必ずテーブル全体をなめる必要がある  
- B. インデックスをたどって、特定の範囲や特定の値のデータだけを効率的に取得できる  
- C. インデックススキャンでは、データページにアクセスする必要はない  
- D. インデックススキャンはクラスタリングされていないと絶対に使えない

**回答:**  
B. インデックスをたどって、特定の範囲や値を効率的に取得できる

---

### 【問題5】
**Search Argument（SARG）にできる条件はどれにゃ？**

- A. `col1 = 100`  
- B. `col2 LIKE '%abc%'`  
- C. `col3 BETWEEN 10 AND 20`  
- D. `col4 IS NULL`

**回答:**  
A. `col1 = 100`

---

### 【ボーナス問題】
**クラスタードインデックスがあるとき、なぜアクセスコストが下がるか？**

**回答:**  
B-treeで物理的にもデータがインデックス順に近く並んでいるため、範囲検索時に1回のI/Oで多くのデータを取得でき、ページアクセス回数が減るためアクセスコストが下がる。

---

## 💬 感想・気づき

- 英語論文を読むのは大変だったが、キーワードと要点を先に押さえてから読むことで理解しやすくなった。
- SQL処理の4段階（パース→最適化→コード生成→実行）の流れが頭に入ったことで、オプティマイザの位置づけが明確に理解できた。
- インデックススキャンやセグメントスキャンの仕組み、特にクラスタリングの影響について、実務でも活かせそうな知識を得られた。
- Section4以降はコスト推定や動的計画法が登場するため、さらに集中して取り組む必要があると感じた。

---

## 📕 参考文献（ある場合だけ）

- Selinger, P. Griffiths et al., *Access Path Selection in a Relational Database Management System*, 1979.

---

# 🗓️ 2025年04月30日（水）学習ログ（WebAPI:TheGoodParts：3章）

## ✅ 学習概要

- 要点  
  - [Good] JSON、あるいは目的に応じたデータ形式を採用する
  - [Good] データを不要なエンベロープで包まない
  - [Good] レスポンスをできる限りフラットな構造にする
  - [Good] 各データの名前が簡潔で理解しやすく、適切な単数複数が用いられている
  - [Good] エラーの形式を統一し、クライアント側でエラー詳細を機械的に理解可能にする
- 『Web API: The Good Parts』第 3 章「レスポンスデータの設計」を読了
- API のレスポンス設計と実務での設計を振り返りながら、設計視点の学びを深めた

---

## 📚 使用教材

- 『Web API: The Good Parts』（第 3 章）

---

## 📖 学習範囲・内容

- データフォーマットは現在 JSON が主流、それ以外はオプション
- レスポンスはなるべくフラット、どうしても階層化した方がいい場合は階層化する
- 配列とフォーマットでレスポンス全体をオブジェクトにすることでセキュリティ上のリスクを避けることができる

---

## 📊 疑問点と確認結果

| 疑問                                                                                     | メモ・確認ポイント                                 |
| :--------------------------------------------------------------------------------------- | :------------------------------------------------- |
| ① スネークケースの優位性が知りたい、現在も変わらず？                                     | 明確な差はなさげ、言語に応じた形に落ち着いている？ |
| ② レスポンスの配列をオブジェクトで包むセキュリティ上のメリットがいまいち理解できなかった |   JSONインジェクションを防ぐため                                                 |

### ゴエモン（ChatGPT の回答）

### ① スネークケースの優位性が知りたい、現在も変わらず？

これは**「統計的な決定打はないけど、文化や傾向としてはある」**って感じにゃ！

🔹 **客観的なデータは…？**  
論文や大規模な調査で「snake_case の方が優れている」と断定したものは特にないにゃ。

ただ、以下のような背景で「良いとされやすい」風潮はあるにゃ：

| 背景         | 内容                                                                    |
| ------------ | ----------------------------------------------------------------------- |
| DB 由来      | RDB では user_name のようなスネークが定番で、API でもそのまま使うと自然 |
| 多言語対応   | Python/Ruby/C 系などで snake_case 文化がある言語と連携しやすい          |
| 可読性重視派 | 「単語の区切りが視覚的に分かりやすい」と感じる人が一定数いるにゃ        |

でも、Java → TypeScript といった開発経験の流れだと、camelCase が主流になるにゃ！

✅ **まとめ**  
snake_case が「ポジティブ」というより、**「場面によって自然な選択」**って感じに

#### ② レスポンスの配列をオブジェクトで包むセキュリティ上のメリットがいまいち理解できなかった

ここがちょっと難しめで、でも超大事なポイントにゃ！

🔥 **なぜ JSON 配列だけを返すとセキュリティ上リスクがあるの？**  
それは「JSON インジェクション攻撃」と呼ばれる脆弱性に関係してるにゃ。

💥 **JSON インジェクションとは？**  
JSON として返すべきデータが JavaScript として解釈されて実行されてしまうケースにゃ

特に、application/json が正しく指定されていない、古いブラウザでは、

```
["foo", "bar"]
```

というレスポンスが スクリプト扱いされてしまうことがあるにゃ！

👿 **実際の攻撃例（昔の IE など）**

```
<script src="https://example.com/api/users"></script>
```

このとき、API のレスポンスが ["admin", "user"] みたいな素の配列だけだと、
ブラウザが 「これは JS コードだ！」 と誤解して実行されちゃうことがあるにゃ…！

✅ **だから防ぐ方法としては**：  
JSON のトップレベルは必ずオブジェクトにする

```
{
"users": ["admin", "user"]
}
```
これなら「ただのオブジェクトだから JS 実行じゃないよね」ってちゃんと解釈されるにゃ！

✅ **補足にゃ**  
現代のブラウザやライブラリ（fetch, axios など）ではこの問題はかなり減ってる

でも、「REST API 設計の防御的スタンス」として今もベストプラクティスにゃ！

✨ **まとめにゃ！**

| ポイント | 内容 |
| ------- | ---- |
| スネークケース | 客観データは少ないが、文化的な選好や連携性で使われるにゃ |
| JSON 配列のラップ | 昔のブラウザで JS として実行されるリスクを防ぐため |
→ オブジェクトで包もう！ は防御設計の基本にゃ

---

## 💬 感想・気づき

- レスポンス設計はフラット構造＋一貫性が大事
- JSON の台頭と XML の歴史的な流れが Google トレンドで見えて面白かった
- JSONP はセキュリティ上の課題もあり、今では基本使われない
- 実務でも S3・Next.js で CORS 設定を経験済みで、理論と現場のつながりを感じた
- 色々な外部公開されている API を見て設計を学びたい

## 🔍 今後深掘りしたいテーマ
- 『Web API: The Good Parts』第5章まで読了後、外部APIの構造調査を実施予定
  - GitHub API
  - SmartHR API（実務で使用中）
  - ZOHO API（今後業務で使用予定）
- 調査タイミングはGW中（候補：2025/05/05）
- 調査項目は以下を中心に記録予定：
  - エンドポイントの構造
  - 認証方式（OAuth2.0等）
  - レスポンス形式・ネスト構造
  - ページング、エラーハンドリング

---

## 📕 参考文献（ある場合だけ）

- 教科書関連
- 関連文献

---

# 🗓️ 2025 年 05 月 02 日（曜日）学習ログ（テーマ）

## ✅ 学習概要

- 『やさしくわかる統計学のための数学』を読んだ
- 本日は第 1 章から第 4 章を読んで、記述統計学〜正規分布の母平均の 95%信頼区間まで学んだ

---

## 🕰️ 学習時間

150 分

---

## 📚 使用教材

- [『中学レベルかはじめる！やさしくわかる統計学のための数学』](https://www.natsume.co.jp/np/isbn/9784816366147/)

### 教材の説明

- 統計学検定 2 級を受験する際に使用したメインテキスト（回帰分析や記述統計は少し足りない）、2 級レベルの内容の復習のために使用
- 目次
  - 第 1 章 データを整理する
  - 第 2 章 統計を理解するためのキホンの確率
  - 第 3 章 正規分布なしでは生きられない
  - 第 4 章 部分から全体を推定する（基礎編）
  - 第 5 章 部分から全体を推定する（発展編）
  - 第 6 章 仮説を検証する 仮設検定（基礎編）
  - 第 7 章 仮説を検証する 仮設検定（発展編）
  - 第 8 章 データ間の関係を分析する

---

## 📖 学習範囲・内容

- 独立事象の乗法定理

```math
P(A∩B) = P(A)*P(B)
```

- 確率変数の期待値と分散の公式

```math
E(aX+b) = aE(X) + b \\
V(aX+b) = a^2V(X)
```

- 分散

```math
V(X)= E(X^2) - {E(X)}^2
```

- 確率変数の輪の期待値

```math
E(X+Y) = E(X) + E(Y)
```

- 互いに独立な確率変数の公式

```math
E(XY) = E(X) * E(Y) \\
V(XY) = V(X) + V(Y)
```

- 二項分布

```math
B(n, p) \\
E(X) = np \\
V(X) = np(1-p) \\
s(X) = \sqrt{np(1-p)}
```

- ラプラスの定理：二項分布の n の回数を十分に大きくすると正規分布 N(np, np(1-p))に近似する
- ポワソン分布 → 二項分布 B(n, p)で確率 p が非常に小さい場合に利用

```math
P(X = k) = \frac{λ^k}{k!}e^{-λ}
```

- 正規分布 N(μ, σ^2)の基本統計量

```math
E(X) = μ \quad V(X) = σ^2 \quad s(X) = σ
```

- チェビシェフの不等式

```math
確率変数Xがどんな分布に従う場合でも、\\
μ - kσ ≦ X ≦ μ + kσ \\
を満たさない確率は\frac{1}{k^2}以下となる（ただし、kは任意の正の数）
```

- 標本平均 x̄ の公式

```math
平均μ、分散σ^2の母集団から大きさnの標本を抽出し、標本平均x̄を求めることをなん度も繰り返し、x̄の平均と分散を求めると、次のことが成り立つ。\\
①標本平均x̄の平均E(x̄)は、母平均μに等しい \\
E(x̄) = μ \\
②標本平均x̄の分散V(x̄)は、母分散/nに等しい \\
V(x̄) = \frac{σ^2}{n}

```

- 大数の法則：標本の大きさ n を大きくしていくと、標本平均 x̄ は母平均 μ に一致する
- 中心極限定理

```math
標本平均x̄は、標本の大きさnがじゅうぶんに大きければ、平均μ、分散\frac{σ^2}{n}の正規分布に近似的にしたがう
```

- 不偏分散

```math
U^2 = \frac{\sum(Xi - x̄)}{n-1} \\
E(U^2) = σ^2
```

- 母比率の推定

```math
r - 1.96 \sqrt{\frac{r(1-r)}{n}} ≦ p ≦ r + 1.96 \sqrt{\frac{r(1-r)}{n}}
```

---

## 📊 疑問点と確認結果

| 疑問                                                                        | ゴエモン（ChatGPT）の回答                      |
| :-------------------------------------------------------------------------- | :--------------------------------------------- |
| 各公式が色々と出てきたけど統計検定準 1 級ではどこまで導出できた方がいいのか | 分散の公式は導出できるところまでできた方が良い |
| 母比率の計算の導出がいまいちすんなり理解できない                            | p がわからないから、r を使って近似             |

### 回答

#### 🐾 疑問 ①：統計検定準 1 級ではどこまで導出できた方がいい？

✅ **結論にゃ**：
導出“できるに越したことはないけど、暗記＋簡単な説明ができれば OK”が基本にゃ！

詳細にゃ：

| 公式                | 導出レベル              | ポイント                                                      |
| :------------------ | :---------------------- | :------------------------------------------------------------ |
| E(aX+b)=aE(X)+b     | 説明できると理想        | 線形性の話として、分かると応用しやすいにゃ                    |
| V(aX+b)=a^2\*V(X)   | 同上                    | 平方の影響と「定数項 b は分散に関係しない」理解が大事         |
| (X)=E(X^2)−[E(X)]^2 | 導出できると ◎          | これは準 1 級では頻出。少なくとも変形の形は言えるように       |
| 不偏分散            | 余裕あれば導出したい    | 証明そのものより、「なぜ n−1 で割るのか？」の説明が超大事にゃ |
| 母比率の信頼区間    | 導出までできなくても OK | 式を使って正確に解ければ十分（でも流れはざっくり理解したい）  |
| 中心極限定理        | 定義を言えれば十分      | 証明は不要。標本平均が正規分布に近づく理由を説明できれば ◎    |

#### 🐾 疑問 ②：母比率の推定の導出がわかりにくい！

✅ **ポイントは 中心極限定理を使って近似していることにゃ！**

```math
𝑟 = \frac{𝑥}{n}（標本比率）
```

中心極限定理によって：

```math
𝑟 ∼ 𝑁(𝑝,\frac{𝑝(1−𝑝)}{𝑛})
```

でも p は未知なので、p の代わりに r を代入して近似するにゃ！

→ このときの信頼区間の公式が：

```math
r±z・\sqrt{\frac{r(1-r)}{n}}
```

​

（ここで z = 1.96 は 95% 信頼区間のための値にゃ）

🧠 **ここが混乱ポイント！**
「分布の中心が p（母比率）」なのに、r を使っていいの？ → 理由：「p がわからないから、r を使って近似」
→ このあたりが腹落ちしにくいけど、「推定だから不確実さがある。でも r から p を推測したい」というベイズ的な発想に近いにゃ！

#### 🐾 補足 Tips（チェックリスト形式）

| チェック項目                                         | OK にゃ？                    |
| :--------------------------------------------------- | :--------------------------- |
| 中心極限定理の意味を言葉で説明できる                 | ✅                           |
| 不偏分散の意味と n−1 の理由を説明できる              | ✅（導出までは余裕があれば） |
| 信頼区間の「±」が何を意味しているか説明できる        | ✅                           |
| 「標本比率を使って母比率を推定する」流れが説明できる | ✅                           |

---

## 💬 感想・気づき

- 復習なので、練習問題などは問題なく解けたが、公式の導出の証明などが若干怪しい部分がある
- チェビシェフの不等式の公式や不偏分散の導出などの証明はできた方がいいのか、簡単な数式ではあるけどなかなか導出までの距離が長くてなかなか腹落ちできない
- 統計検定 2 級対策をしていたときもだけど、やっぱり母比率の推定のところはスラスラ解けない
- この本でも Excel を使った確率計算があるので徐々に Excel や統計ツールを使った学習もしていきたい
- 標本平均の分散でデータ数で割るのを忘れることがたまにある

---

## 📕 参考文献（ある場合だけ）

- 教科書関連
- 関連文献

